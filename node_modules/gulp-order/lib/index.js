// Generated by CoffeeScript 1.7.1
(function() {
  var minimatch, through;

  through = require("through");

  minimatch = require("minimatch");

  module.exports = function(patterns) {
    var files, onEnd, onFile, rank;
    if (patterns == null) {
      patterns = [];
    }
    files = [];
    onFile = function(file) {
      return files.push(file);
    };
    rank = function(s) {
      var index, pattern, _i, _len;
      for (index = _i = 0, _len = patterns.length; _i < _len; index = ++_i) {
        pattern = patterns[index];
        if (minimatch(s, pattern)) {
          return index;
        }
      }
      return patterns.length;
    };
    onEnd = function() {
      files.sort(function(a, b) {
        var aIndex, bIndex;
        aIndex = rank(a.relative);
        bIndex = rank(b.relative);
        if (aIndex === bIndex) {
          return String(a.relative).localeCompare(b.relative);
        } else {
          return aIndex - bIndex;
        }
      });
      files.forEach((function(_this) {
        return function(file) {
          return _this.emit("data", file);
        };
      })(this));
      return this.emit("end");
    };
    return through(onFile, onEnd);
  };

}).call(this);
