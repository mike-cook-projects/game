"use strict";angular.module("game",["templates","game.services.tiles","game.factories.tile","game.directives.tile"]).constant("MAP_HEIGHT",20).constant("MAP_WIDTH",20).controller("GameCtrl",["Tiles","MAP_HEIGHT","MAP_WIDTH",function(e,t,n){var i=this;i.tiles=e.list,i.createMap=function(){for(var i=0;t>i;i++)for(var o=0;n>o;o++)e.addTile({x:i,y:o,z:0},{type:"grass"})},i.createMap()}]),function(e){try{e=angular.module("templates")}catch(t){e=angular.module("templates",[])}e.run(["$templateCache",function(e){e.put("common/directives/tile/tile.html",'<div id="{{ tile.data.id }}"\n     style="z-index: {{ tile.data.translated.z }}; left: {{ tile.data.translated.y }}px; top: {{ tile.data.translated.x }}px;"\n     class="tile {{ tile.data.type }}">\n  <div ng-click="tile.onClick($event)"\n       ng-mouseenter="tile.onMouseenter($event)"\n       ng-mouseout="tile.onMouseout($event)"\n       class="face top"></div>\n  <div ng-click="tile.onClick($event)"\n       ng-mouseenter="tile.onMouseenter($event)"\n       ng-mouseout="tile.onMouseout($event)"\n       class="face left thin_face"></div>\n  <div ng-click="tile.onClick($event)"\n       ng-mouseenter="tile.onMouseenter($event)"\n       ng-mouseout="tile.onMouseout($event)"\n       class="face right thin_face"></div>\n</div>')}])}(),angular.module("game.services.tiles",[]).service("Tiles",["Tile",function(e){var t=this;t.list=[],t.guide=null,t.addTile=function(n,i){var o=t.findTileByPosition(n);return o&&t.remove(o),o=new e(n,i),o.index=t.list.length,t.list.push(o),o},t.findTileByPosition=function(e){var n=null;return angular.forEach(t.list,function(t){t.position.x===e.x&&t.position.y===e.y&&t.position.z===e.z&&(n=t)}),n},t.remove=function(e){t.list.splice(e.index,1),e=null,t.seed()},t.seed=function(){var e=0;angular.forEach(t.list,function(t){t.index=e++})}}]),angular.module("game.factories.tile",[]).constant("TILE_WIDTH",45).constant("TILE_HEIGHT",26).constant("Z_LEVEL_ADJUSTMENT",2e3).constant("Z_ROW_ADJUSTMENT",100).constant("Z_OFFSET",22).factory("Tile",["TILE_WIDTH","TILE_HEIGHT","Z_LEVEL_ADJUSTMENT","Z_ROW_ADJUSTMENT","Z_OFFSET",function(e,t,n,i,o){return function(a,l){var s=this;s.translated={x:0,y:0,z:0},s.position={x:0,y:0,z:0},s.type=l.type,s.setPosition=function(a){s.position={x:a.x||s.position.x,y:a.y||s.position.y,z:a.z||s.position.z},s.translated={x:t*a.x*-1+a.y*t-a.z*o,y:e*a.x+a.y*e,z:a.z*n+a.y*i-a.x}},s.setPosition(a)}}]),angular.module("game.directives.tile",[]).controller("TileCtrl",["Tiles",function(e){var t=this;t.setupTile=function(){"guide"===t.data.type&&t.element.css("pointer-events","none")},t.onClick=function(n){if(e.guide&&(e.remove(e.guide),e.guide=null,console.log("removed it",e.guide)),n.shiftKey)return e.remove(t.data),!1;var i=angular.element(n.toElement),o={x:i.hasClass("left")?t.data.position.x-1:t.data.position.x,y:i.hasClass("right")?t.data.position.y+1:t.data.position.y,z:i.hasClass("top")?t.data.position.z+1:t.data.position.z};e.addTile(o,{type:"grass"})},t.onMouseenter=function(n){if("guide"===t.data.type)return!1;var i=angular.element(n.toElement),o={x:i.hasClass("left")?t.data.position.x-1:t.data.position.x,y:i.hasClass("right")?t.data.position.y+1:t.data.position.y,z:i.hasClass("top")?t.data.position.z+1:t.data.position.z};e.guide=e.addTile(o,{type:"guide"})},t.onMouseout=function(){console.log("removing?",e.guide),e.guide&&e.remove(e.guide)}}]).directive("tile",function(){return{restrict:"E",controller:"TileCtrl as tile",templateUrl:"common/directives/tile/tile.html",scope:{ngModel:"="},link:function(e,t,n,i){i.element=t,i.data=e.ngModel,i.setupTile()}}});